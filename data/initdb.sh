#!/bin/bash

psql -v ON_ERROR_STOP=1 --username "$POSTGRES_USER" -d "$POSTGRES_DB"  <<-EOSQL
CREATE ROLE $POSTGREST_ANON_ROLE WITH
  NOLOGIN
  NOSUPERUSER
  INHERIT
  NOCREATEDB
  NOCREATEROLE
  NOREPLICATION
  NOBYPASSRLS;

CREATE ROLE $POSTGREST_USER WITH
  LOGIN
  NOSUPERUSER
  NOINHERIT
  NOCREATEDB
  NOCREATEROLE
  NOREPLICATION
  NOBYPASSRLS
  PASSWORD '$POSTGREST_PASSWORD';

GRANT $POSTGREST_ANON_ROLE TO $POSTGREST_USER;
GRANT USAGE ON SCHEMA public TO $POSTGREST_ANON_ROLE;
EOSQL